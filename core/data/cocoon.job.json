{
  "Job": {
    "Region": "global",
    "ID": "cocoon-{{ID}}",
    "Name": "cocoon-{{ID}}",
    "Type": "service",
    "Priority": 50,
    "AllAtOnce": false,
    "Datacenters": [
      "dc1"
    ],
    "Constraints": [
      {
        "LTarget": "${attr.kernel.name}",
        "RTarget": "linux",
        "Operand": "="
      }
    ],
    "TaskGroups": [
      {
        "Name": "cocoon-{{ID}}",
        "Count": {{Count}},
        "Constraints": null,
        "Tasks": [
          {
            "Name": "cocoon-task-{{ID}}",
            "Driver": "docker",
            "Config": {
              "image": "{{Image}}",
              "force_pull": true,
              "command": "bash",
              "args": ["${NOMAD_META_SCRIPTS_DIR}/${NOMAD_META_DEPLOY_SCRIPT_NAME}"],
              "privileged": true,
              "port_map": [{
                "connector-http": 3000
              }]
            },
            "Env": {
              "COCOON_ID": "cocoon-{{ID}}",
              "COCOON_CODE_URL": "{{CocoonCodeURL}}",
              "COCOON_CODE_TAG": "{{CocoonCodeTag}}",
              "COCOON_CODE_LANG": "{{CocoonCodeLang}}"
            },
            "Services": [{
              "Name": "cocoons",
              "Tags": ["{{ID}}"],
              "PortLabel": "connector-http"   
            }],
            "Meta": {
              "DEPLOY_SCRIPT_NAME": "run-launcher.sh",
              "COCOON_GROUPS_SCRIPT_NAME": "cocoon-groups.sh",
              "SCRIPTS_DIR": "/local/scripts"
            },
            "LogConfig": {
              "MaxFiles": 10,
              "MaxFileSizeMB": 10
            },
            "Templates": [],
            "Artifacts": [{
                "GetterSource": "https://raw.githubusercontent.com/ncodes/cocoon/master/scripts/${NOMAD_META_DEPLOY_SCRIPT_NAME}",
                "RelativeDest": "/local/scripts"
            },
            {
                "GetterSource": "https://raw.githubusercontent.com/ncodes/cocoon/master/scripts/${NOMAD_META_COCOON_GROUPS_SCRIPT_NAME}",
                "RelativeDest": "/local/scripts"
            }],
            "Resources": {
              "CPU": {{CPU}},
              "MemoryMB": {{MemoryMB}},
              "IOPS": 0,
              "Networks": [
                {
                  "MBits": 200,
                  "DynamicPorts":[
                    { "Label":"connector-http"}
                  ]
                }
              ]
            },
            "DispatchPayload": {}
          }
        ],
        "Resources": {
          "CPU": {{CPU}},
          "MemoryMB": {{MemoryMB}},
          "DiskMB": {{DiskMB}},
          "IOPS": 0,
          "Networks": []
        },
        "RestartPolicy": {
          "Interval": 300000000000,
          "Attempts": 10,
          "Delay": 25000000000,
          "Mode": "delay"
        },
        "Meta": {}
      }
    ],
    "Update": {
      "Stagger": 10000000000,
      "MaxParallel": 1
    }
  }
}